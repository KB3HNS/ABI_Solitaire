<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>Developer Notes</title>
</head>
<body
 style="color: rgb(255, 255, 255); background-color: rgb(0, 128, 0);"
 alink="#ffff00" link="#ffff00" vlink="#cccccc">
<div style="text-align: center;"><span
 style="color: rgb(255, 204, 255);"><font size="+3">Developer Notes:<br>
<br>
</font></span>
<div style="text-align: left;"><font size="+1"><span
 style="color: rgb(255, 204, 255);"><span
 style="color: rgb(255, 255, 255);"><span style="font-weight: bold;">Files:</span>&nbsp;
</span></span></font><span style="color: rgb(255, 204, 255);"><span
 style="color: rgb(255, 255, 255);">Solitaire file formats are mode I
(binary).&nbsp; All files must have the same header: <br>
&nbsp;&nbsp;&nbsp; byte 1:&nbsp;&nbsp; (char)datum --&nbsp; this is a
value that the parent (solitaire.exe) passes to the class
constructor.&nbsp; The parent uses this to determine file
compatibility, and the file name.&nbsp; The information contained
therein is soly assigned by the parent application.&nbsp; <br>
&nbsp;&nbsp;&nbsp; byte 2:&nbsp; (char)strlen(game-&gt;name()) + 1 --
the length of&nbsp; the return from game-&gt;name();<br>
&nbsp;&nbsp;&nbsp; byte 3 - 3+(value of byte 2):&nbsp; The game name as
given in method game::name();<br>
&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">End of header</span><br>
&nbsp;&nbsp;&nbsp; next set of bytes:&nbsp; The card array.&nbsp; By
default, this is 52 bytes of data, one byte for each card.&nbsp;
However, games can change this length.<br>
&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">Game specific
information follows:<br>
<span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; </span></span>last
byte:&nbsp; fixed - 0xFF.&nbsp; This is to ensure that the file is
correct.&nbsp; <br>
<br>
&nbsp;&nbsp;&nbsp; In the future, a version section may be added to the
header.&nbsp; Implimenting the API would be as easy as creating a macro
and adding a putc(file, MACRO) statement.<br>
<br>
<font size="+1"><span style="font-weight: bold;">The Class:&nbsp; </span></font>The
solitaire app is responsible for creating the parent window, setting
the initial background color, creating the game class, entering the
infinite loop, and processing the host OS commands.&nbsp; For
portability sake, the game class is always a type Solitaire in the
current namespace (i.e. not namespace specific).&nbsp; Therefore,
specific gametypes may be generated by calling a static_cast to a new
(ex:&nbsp; Solitaire *game = static_cast&lt;Solitaire*&gt;(new
StreetsAndAlleys*(hWnd, datum));<br>
&nbsp;&nbsp;&nbsp; A note about the arguments:&nbsp; hWnd is a Windows
specific pointer to a valid Window Handel.&nbsp; The game class keeps
track of it's drawing screen, and not the drawing library.&nbsp;
Although this code is OS specific and appears in Solitaire as well as
all of it's inheriters, all files include a stdafx.h file.&nbsp;
Whatever the platform (GDI/GDI+, QT, GTK/GTK+, X11R6) only a typedef
HWND statement is required to declare the appropriate pointer.&nbsp;
datum is an int passed to the class for file identification
purposes.&nbsp; <br>
&nbsp;&nbsp;&nbsp; Once the application has entered the infinite loop,
it must process the following commands and pass them to the game class:<br>
<span style="font-weight: bold;">Keyboard:<br>
<span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; </span></span>left
key - game-&gt;left();<br>
&nbsp;&nbsp;&nbsp; right key - game-&gt;right();<br>
&nbsp;&nbsp;&nbsp; up key - game-&gt;up();<br>
&nbsp;&nbsp;&nbsp; down key - game-&gt;down();<br>
&nbsp;&nbsp;&nbsp; enter - game-&gt;enter();<br>
&nbsp;&nbsp;&nbsp; backspace - game-&gt;undo();<br>
&nbsp;&nbsp;&nbsp; n - game-&gt;shuffel();<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; game-&gt;deal();<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; game-&gt;redrawBoard();<br>
<br>
&nbsp;&nbsp;&nbsp; any other key -&gt;game-&gt;keyPres(char key);<br>
<br>
<span style="font-weight: bold;">Menu Results:<br>
<span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; </span></span>New
- same as key n<br>
&nbsp;&nbsp;&nbsp; Open - game-&gt;open(const char* filename);&nbsp;
note:&nbsp; filename MUST contain the whole path
("c:\\Solitaire\\Games\\foo.sol" or "/home/foo/bar.sol")<br>
&nbsp;&nbsp;&nbsp; Save - game-&gt;save(const char* filename);&nbsp;
same as game-&gt;open(const char*);<br>
&nbsp;&nbsp;&nbsp; Undo - same as key u<br>
&nbsp;&nbsp;&nbsp; Restart - game-&gt;deal();<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; game-&gt;redrawBoard();<br>
<br>
<span style="font-weight: bold;"><span style="font-weight: bold;">Mouse
Events:</span></span><br>
&nbsp;&nbsp;&nbsp; Left Click - game-&gt;leftClick(int X, int Y);&nbsp;
where X and Y are the reletave X and Y coordinates of the mouse to the
game window --&nbsp; NOT ABSOLUTE SCREEN COORDINATES!<br>
&nbsp;&nbsp;&nbsp; Right click - game-&gt;rightClick(int X, int
Y);&nbsp; same as game-&gt;leftClick(int, int);<br>
&nbsp;&nbsp;&nbsp; Right Button Release - game-&gt;rightUp();<span
 style="font-weight: bold;"><span style="font-weight: bold;"></span><br>
<br>
System Events:<br>
<span style="font-weight: bold;">&nbsp;&nbsp;&nbsp; </span></span>game-&gt;redrawBoard();
must be called anytime a board redraw is required.&nbsp; This includes
after window resizes of the platform doesn't support virtual mapping
and whenever a new game is started.&nbsp; <br>
&nbsp;&nbsp;&nbsp; game-&gt;Hit(); must be called any time a user event
occurs (keyboard, mouse, menu, system).&nbsp; The reason for this is
covered in the threading section.<br>
&nbsp;&nbsp;&nbsp; game-&gt;delInst(); must be called before the game
class goes out of scope or is deleted.&nbsp; This allows the child
class(War, etc) to perform class specific cleanup.<br>
<br>
<font size="+1"><span style="font-weight: bold;">Threading:</span></font>&nbsp;
The game class makes use of multithreading.&nbsp; The thread spawn
controls are located int winTeaser.cpp.&nbsp; Multithreading is used
when a game has been won.&nbsp; The Solitaire class maintains a bool
called hit.&nbsp; It is set to true any time game-&gt;hit() is
called.&nbsp; It is done this way so the secondary calls (up(), down(),
etc) can be overridden.&nbsp; Each class is responsible for
implimenting code in a safe manner for threading.&nbsp; Remember, both
a geme-&gt;[event]() and a game-&gt;Hit() call will be generated.&nbsp;
There is no guarantee as to the order in which those calls will arrive
to the class.&nbsp; Typically the entry point for each system call
except those involved in starting a new game or loading a game will
check another class specific bool that is set by the entry to the
multithread.&nbsp; Ex:<br>
game::winWork() {<br>
&nbsp;&nbsp;&nbsp; ...&nbsp; variable declarations ...<br>
&nbsp;&nbsp;&nbsp; [global] bool won = true;<br>
&nbsp;&nbsp;&nbsp; while(!hit) {<br>
&nbsp;&nbsp;&nbsp; ...&nbsp; win animation code ...<br>
<span style="font-weight: bold;"><span style="font-weight: bold;"></span>&nbsp;&nbsp;&nbsp;
}<br>
</span>&nbsp;&nbsp;&nbsp; ...&nbsp; cleanup ...<br>
&nbsp;&nbsp;&nbsp; return [value];&nbsp; // value is the return value
of the thread process, NOT CLASS SPECIFIC<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; that means
returning anything other than some form of 0 will most likely throw an
exception.<br>
}<br>
<br>
game::deal() {<br>
</span></span><span style="color: rgb(255, 204, 255);"><span
 style="color: rgb(255, 255, 255);">&nbsp;&nbsp;&nbsp; ...&nbsp;
variable declarations ...<br>
&nbsp;&nbsp;&nbsp; [global] bool won = false;<br>
</span></span>&nbsp;&nbsp;&nbsp; ..&nbsp; deal code ...<br>
}<br>
<br>
game::up() {<br>
<span style="color: rgb(255, 204, 255);"><span
 style="color: rgb(255, 255, 255);">&nbsp;&nbsp;&nbsp; ...&nbsp;
variable declarations ...<br>
</span></span>&nbsp;&nbsp;&nbsp; if (won) <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; return;<br>
<br>
&nbsp;&nbsp;&nbsp; ..&nbsp; code ...<br>
}<br>
Before the thread terminates, a dialog box will be presented asking the
user if they would like to play again.&nbsp; Their response is handeled
outside of the class.&nbsp; the game::winWork() method contains the
spawned thread code.&nbsp; Solitaire::winTeaser() contains sufficient
code to accomplish this.&nbsp; For further information, consult the
code it's self.&nbsp; The solitaire class is defined in game.cpp with
templates in game.h.&nbsp; winTeaser.cpp contains thread specific
code.&nbsp; Currently, Dummy, dbgDummy, StreetsAndAlleys, and War are
derived classes.&nbsp; <br>
<br>
<span style="font-weight: bold;"><font size="+1">Drawing API:</font></span><font
 size="+1">&nbsp; </font>Solitaire classes require the following
functions.&nbsp; These functions are located in a library (currently
called cardtools.cpp)<br>
void drawCard(HWND hWnd, int xPos, int yPos, int cardNum,
int rotation,<span style=""></span><span style=""> </span>bool
selected, double zoom = 1);<br>
<br>
void eraseCard (HWND hWnd, int cx, int cy, int rotation,
double zoom = 1, int cardNum = 0);
<p class="MsoPlainText">double DegtoRad(int deg);<span style="">&nbsp; </span><br>
</p>
<p class="MsoPlainText">CARDDIM getCardAttributes(int cardNum = 0);</p>
<p class="MsoPlainText">void clearBoard(HWND hWnd);</p>
<o:p> </o:p>int bprintf(HWND hWnd, int x, int y, int
Color, char * , ...);
<p class="MsoPlainText">void putMouse(int x, int y, HWND hWnd);</p>
<p class="MsoPlainText">double axis2zoom(int zoom);</p>
<p class="MsoPlainText">void hsort(int *source, int *dest, int count,
bool down =
false);</p>
<p class="MsoPlainText">CARDDIM getBoardDims(HWND hWnd);</p>
<p class="MsoPlainText">int RadtoDeg(double rad);</p>
Furthermore, the application must call the following functions to prep
the drawing library for class calls:&nbsp; Note:&nbsp; platform
specific init / shutdown code resided in these functions.&nbsp; <br>
<p class="MsoPlainText">void initCards();</p>
<p class="MsoPlainText">void closeCards();<br>
<br>
</p>
<span style="color: rgb(255, 204, 255);"></span></div>
</div>
</body>
</html>
